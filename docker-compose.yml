name: osml10n

services:
  test:
    container_name: test
    image: ${REGISTRY}/osml10n:latest
    entrypoint:
      - /bin/bash
      - -c
      - |
        cd /app
        nohup ./entrypoint.sh &
        cd tests
        retries=6
        while (( retries > 0 )); do
          ./runtests.lua && exit 0
          (( retries-- ))
          sleep 5
        done
        echo "Error: Giving up!"
        exit 1
    volumes:
      - ./lua_osml10/tests:/app/tests/
